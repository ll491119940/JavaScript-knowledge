# HTTP

##  了解Web及网络基础

- 通过发送请求获取服务器资源的web浏览器等，都可称为客户端

###   网络基础`TCP/IP`

- `TCP/IP`协议族按层次分别为一下4层：应用层、传输层、网络层和数据链路层
- 应用层：应用层决定了向用户提供应用服务时通信的活动（FTP、DNS、HTTP）
- 传输层：传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输（TCP、UDP）
- 网络层：网络层用来处理在网络上流动的数据包。该层规定了通过怎样的路径到达对方计算机，并把数据包传送给对方。
- 链路层：用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（即网卡）以及光纤等物理可见部分
- 利用TCP/IP协议族进行网络通信时，会通过分层顺序与对方进行通信。发送端从应用层往下走，接收端从链路层往上走。

###  负责传输的IP协议

按层次分，IP（Internet Protocol）网际协议位于网络层。IP协议的作用是把各种数据包传送给对方。IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址

- 使用ARP协议凭借MAC地址进行通信。ARP协议是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。

###  确保可靠性的TCP协议

按层次分，TCP位于传输层，提供可靠的字节流服务。

**确保数据能到达目标**

为了准确无误地将数据送达目标处，TCP协议采用了三次握手策略。握手过程中使用了TCP的标志——SYN(synchronize)和ACK(acknowledgement)。

发送端首先发送一个带SYN标志的数据包给对方。接收端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认信息。最后，发送端再回传一个带ACK标志的数据包，代表握手结束。

###  负责域名解析的DNS服务

DNS服务是和HTTP协议一样位于应用层的协议，它提供域名到IP地址之间的解析服务。

###  URI

URI（Uniform Resource Identifier）统一资源标识符。URI就是由某个协议方案表示的资源的定位标识符。

##  简单的HTTP协议

###  HTTP协议用于客户端和服务器之间的通信

请求访问文本或图像等资源的一端称为客户端，而提供资源响应的一端称为服务器端

###  通过请求和响应的交换达成通信

请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体构成的。

响应报文基本上由协议版本、状态码、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成

###  HTTP是不保存状态的协议

HTTP是一种不保存状态，即无状态(stateless)协议。协议对于发送过的请求或响应都不做持久化处理。

###   告知服务器意图的HTTP方法

**GET：获取资源**

GET方法用来请求访问已被URI识别的资源。指定的资源经服务器端解析后返回响应内容

**POST：传输实体主体**

**PUT：传输文件**

**HEAD：获得报文首部**

HEAD方法和GET方法一样，只是不返回报文主体部分。用于确认URI有效性及资源更新的日期时间等

**DELETE：删除文件**

DELETE方法用来删除文件，是与PUT相反的方法。

**OPTIONS：询问支持的方法**

OPTIONS方法用来查询针对请求URI指定的资源支持的方法。

**TRACE：追踪路径**

TRACE方法是让Web服务器端将之前的请求通信返回给客户端的方法

**CONNECT：要求用隧道协议连接代理**

CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。

###  持久连接节省通信量

持久连接的特点是，只要任意一端没有明确提出断开连接，则保持TCP连接状态

持久连接使得多数请求以管线化(pipelining)方式发送成为可能。管线化技术出现后，不用等待响应亦可直接发送下一个请求。

###  使用cookie的状态管理

Cookie技术通过在请求和响应报文中写入Cookie信息来控制客户端的状态。Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。

##  HTTP报文内的HTTP信息

###  HTTP报文

请求端的HTTP报文叫做请求报文，响应端的叫做响应报文。

HTTP报文大致可分为报文首部和报文主体两块。报文首部由请求行或状态行、首部字段、其他等数据组成。

首部一般有四种：通用首部、请求首部、响应首部和实体首部

###  编码提升传输速率

通过在传输时编码，能有效地处理大量的访问请求。

####  报文主体和实体主体的差异

- 报文（message） 是HTTP通信中的基本单位，由8位组字节流组成，通过HTTP通信传输
- 实体（entity）作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。

HTTP报文的主体用于传输请求或响应的实体主体。通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。

####  压缩传输的内容编码

内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

####  分割发送的分块传输编码

分块传输编码会将实体主体分成多个部分。每一块都会用十六进制来标记块的大小，而实体主体的最后一块会使用“0（CR+LF）”来标记。

###  发送多种数据的多部分对象集合

我们可以在邮件中写入文字并添加多份附件是因为采用了MIME(Multipurpose Internet Mail Extensions，多用途因特网邮件扩展)机制。在MIME扩展中会使用一种称为多部分对象集合(Multipart)的方法，来容纳多份不同类型的数据。

多部分对象集合包含的对象如下

- `multipart/form-data` 在Web表单文件上传时使用
- `multipart/byteranges` 状态码206响应报文包含了多个范围的内容时使用

在HTTP报文中使用多部分对象集合时，需要在首部字段里加上Content-type。多部分对象集合的每个部分类型中，都可以含有首部字段。

###  获取部分内容的范围请求

执行范围请求时，会用到首部字段Range来指定资源的byte范围。

`Range: bytes=5001-10000` 5001~10000字节

`Range: bytes=5001-`从5001字节之后全部的

###  内容协商返回最合适的内容

内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为适合的资源。包含在请求报文中的某些首部字段就是判断的基准。

##  返回结果的HTTP状态码

###  状态码告知从服务器端返回的请求结果

 

|      | 类别                             | 原因短语                   |
| ---- | -------------------------------- | -------------------------- |
| 1XX  | Informational（信息性状态码）    | 接收的请求正在处理         |
| 2XX  | Success（成功状态码）            | 请求正常处理完毕           |
| 3XX  | Redirection（重定向状态码）      | 需要进行附加操作以完成请求 |
| 4XX  | Client Error（客户端错误状态码） | 服务器无法处理请求         |
| 5XX  | Server Error（服务器错误状态码） | 服务器处理请求出错         |

###  2XX 成功

####  200 OK

####  204 No Content

####  206 Partial Content

###  3XX 重定向

####  301 Moved Permanently

####  302 Found

####  303 See Other

####  304 Not Modified

####  307 Temporary Redirect

###  4XX 客户端错误

####  400 Bad Request

####  401 Unauthorized

####  403 Forbidden

####  404 Not Found

###  5XX 服务器错误

####  500 Internal Server Error

####  503 Service Unavailable

##  与HTTP协作的Web服务器

###  用单台虚拟主机实现多个域名

即使物理层面只有一台服务器，但只要使用虚拟主机的功能，则可以假想已具有多台服务器。在相同的IP地址下，由于虚拟主机可以寄存多个不同主机名和域名的Web网站，因此在发送HTTP请求时，必须在Host首部内完整指定主机名或域名的URI。

###  通信数据转发程序：代理、网关、隧道

- 代理

代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端“中间人”的角色。

代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。使用代理服务器的理由有：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的，等等。

**缓存代理**

代理转发响应时，缓存代理会预先将资源的副本保存在代理服务器上。

**透明代理**

转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理。反之，对报文内容进行加工到的代理被称为非透明代理。

- 网关

网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。

网关能使通信线路上的服务器提供非HTTP协议服务。

- 隧道

隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。

隧道可按要求建立起一条与其他服务器的通信线路，届时使用SSL等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信。

## HTTP首部

###  HTTP首部字段传递重要信息

使用首部字段是为了给浏览器和服务器提供报文主体大小、所使用的语言、认证信息等内容。

###  HTTP首部字段结构

HTTP首部字段是由首部字段名和字段值构成的，中间用冒号'：'分隔。

`首部字段名：字段值`

`Content-type: text/html`

###  4种HTTP首部字段类型

- 通用首部字段（General Header Fields）请求报文和响应报文都会使用的首部
- 请求首部字段（Request Header Fields）发送请求报文时使用的首部
- 响应首部字段（Response Header Fields）返回响应报文时使用的首部
- 实体首部字段（Entity Header Fields）针对请求报文和响应报文的实体部分使用的首部

###  HTTP/1.1 首部字段一览

**通用首部字段**

| 首部字段名        | 说明                       |
| ----------------- | -------------------------- |
| Cache-Control     | 控制缓存的行为             |
| Connection        | 逐跳首部、连接的管理       |
| Date              | 创建报文的日期时间         |
| Pragma            | 报文指令                   |
| Trailer           | 报文末端的首部一览         |
| Transfer-Encoding | 指定报文主体的传输编码方式 |
| Upgrade           | 升级为其他协议             |
| Via               | 代理服务器的相关信息       |
| Warning           | 错误通知                   |

**请求首部字段**

| 首部字段名          | 说明                                          |
| ------------------- | --------------------------------------------- |
| Accept              | 用户代理可处理的媒体类型                      |
| Accept-Charset      | 优先的字符集                                  |
| Accept-Encoding     | 优先的内容编码                                |
| Accept-Language     | 优先的语言（自然语言）                        |
| Authorization       | Web认证信息                                   |
| Expect              | 期待服务器的特定行为                          |
| From                | 用户的电子邮箱地址                            |
| Host                | 请求资源所在服务器                            |
| If-Match            | 比较实体标记（ETag）                          |
| If-Modified-Since   | 比较资源的更新时间                            |
| If-None-Match       | 比较实体标记（与If-Match相反）                |
| If-Range            | 资源未更新时发送实体Byte的范围请求            |
| If-Unmodified-Since | 比较资源的更新时间（与If-Modified-Since相反） |
| Max-Forwards        | 最大传输逐跳数                                |
| Proxy-Authorization | 代理服务器要求客户端的认证信息                |
| Range               | 实体的字节范围请求                            |
| Referer             | 对请求中URI的原始获取方                       |
| TE                  | 传输编码的优先级                              |
| User-Agent          | HTTP客户端程序的信息                          |

**响应首部字段**

| 首部字段名         | 说明                         |
| ------------------ | ---------------------------- |
| Accept-Ranges      | 是否接受字节范围请求         |
| Age                | 推算资源创建经过时间         |
| ETag               | 资源的匹配信息               |
| Location           | 令客户端重定向至指定URI      |
| Proxy-Authenticate | 代理服务器对客户端的认证信息 |
| Retry-After        | 对再次发起请求的时机要求     |
| Server             | HTTP服务器的安装信息         |
| Vary               | 代理服务器缓存的管理信息     |
| WWW-Authenticate   | 服务器对客户端的认证信息     |

**实体首部字段**

| 首部字段名       | 说明                         |
| ---------------- | ---------------------------- |
| Allow            | 资源可支持的HTTP方法         |
| Content-Encoding | 实体主体适用的编码方式       |
| Content-language | 实体主体的自然语言           |
| Content-Length   | 实体主体的大小（单位：字节） |
| Content-Location | 替代对应资源的URI            |
| Content-MD5      | 实体主体的报文摘要           |
| Content-Range    | 实体主体的位置范围           |
| Content-Type     | 实体主体的媒体类型           |
| Expires          | 实体主体过期的日期时间       |
| Last-Modified    | 资源的最后修改日期时间       |

###  非HTTP/1.1首部字段

在HTTP协议通信交互中使用到的首部字段，不限于RFC2616中定义的47种首部字段。还有Cookie、Set-Cookie和Content-Disposition等在其他RFC中定义的首部字段。

